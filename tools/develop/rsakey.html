<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA密钥生成工具</title>
    <!-- 优先使用Cloudflare CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- 加密库 - 使用官网CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/forge/0.10.0/forge.min.js"></script>
    <!-- ZIP处理库 - 使用Cloudflare CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- 文件保存库 - 使用Cloudflare CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- 配置Tailwind自定义样式 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#4f46e5',
                        neutral: '#f0f4f8',
                        dark: '#1e293b'
                    },
                    boxShadow: {
                        'neumorphic': '9px 9px 16px rgba(163, 177, 198, 0.6), -9px -9px 16px rgba(255, 255, 255, 0.5)',
                        'neumorphic-inset': 'inset 5px 5px 10px rgba(163, 177, 198, 0.6), inset -5px -5px 10px rgba(255, 255, 255, 0.5)',
                        'neumorphic-pressed': 'inset 2px 2px 5px rgba(163, 177, 198, 0.6), inset -2px -2px 5px rgba(255, 255, 255, 0.5)'
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .neumorphic {
                @apply bg-neutral rounded-2xl shadow-neumorphic transition-all duration-300;
            }
            .neumorphic-inset {
                @apply bg-neutral rounded-xl shadow-neumorphic-inset transition-all duration-300;
            }
            .neumorphic-btn {
                @apply bg-neutral rounded-xl shadow-neumorphic hover:shadow-neumorphic-pressed active:shadow-neumorphic-pressed transition-all duration-300 transform hover:-translate-y-0.5 active:translate-y-0;
            }
            .key-textarea {
                @apply w-full h-full p-4 bg-transparent border-none resize-none focus:outline-none text-sm md:text-base;
            }
        }
    </style>
</head>
<body class="bg-neutral min-h-screen font-sans text-dark p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- 标题区域 -->
        <div class="neumorphic p-6 mb-6 text-center">
            <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-primary mb-2">RSA密钥生成工具</h1>
            <p class="text-gray-600">生成RSA公钥和私钥，支持复制和导出功能</p>
        </div>
        
        <!-- 配置区域 -->
        <div class="neumorphic p-5 mb-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <label for="keySize" class="font-medium">密钥长度:</label>
                    <select id="keySize" class="neumorphic-inset px-3 py-2">
                        <option value="1024">1024位 (基本安全)</option>
                        <option value="2048" selected>2048位 (推荐)</option>
                        <option value="4096">4096位 (高安全)</option>
                    </select>
                </div>
                <button id="generateBtn" class="neumorphic-btn px-6 py-3 font-medium flex items-center justify-center gap-2">
                    <i class="fa fa-refresh"></i>
                    <span>生成密钥对</span>
                </button>
            </div>
        </div>
        
        <!-- 密钥显示区域 - 响应式布局 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- 私钥区域 -->
            <div class="neumorphic p-5 flex flex-col h-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold flex items-center gap-2">
                        <i class="fa fa-lock text-primary"></i>
                        <span>私钥</span>
                    </h2>
                    <button id="copyPrivateBtn" class="neumorphic-btn p-2 text-sm">
                        <i class="fa fa-copy mr-1"></i> 复制
                    </button>
                </div>
                <div class="neumorphic-inset flex-grow min-h-[200px] md:min-h-[300px]">
                    <textarea id="privateKey" class="key-textarea" placeholder="生成的私钥将显示在这里..." readonly></textarea>
                </div>
            </div>
            
            <!-- 公钥区域 -->
            <div class="neumorphic p-5 flex flex-col h-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold flex items-center gap-2">
                        <i class="fa fa-unlock text-primary"></i>
                        <span>公钥</span>
                    </h2>
                    <button id="copyPublicBtn" class="neumorphic-btn p-2 text-sm">
                        <i class="fa fa-copy mr-1"></i> 复制
                    </button>
                </div>
                <div class="neumorphic-inset flex-grow min-h-[200px] md:min-h-[300px]">
                    <textarea id="publicKey" class="key-textarea" placeholder="生成的公钥将显示在这里..." readonly></textarea>
                </div>
            </div>
        </div>
        
        <!-- 导出区域 -->
        <div class="neumorphic p-5 text-center">
            <button id="exportBtn" class="neumorphic-btn px-6 py-3 font-medium flex items-center justify-center gap-2 mx-auto" disabled>
                <i class="fa fa-download"></i>
                <span>导出密钥包 (ZIP)</span>
            </button>
            <p class="text-xs text-gray-500 mt-3">导出将包含private_key.pem和public_key.pem两个文件</p>
        </div>
        
        <!-- 状态提示区域 -->
        <div id="notification" class="fixed bottom-6 right-6 p-4 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center gap-3 max-w-xs"></div>
    </div>

    <script>
        // DOM元素
        const generateBtn = document.getElementById('generateBtn');
        const copyPrivateBtn = document.getElementById('copyPrivateBtn');
        const copyPublicBtn = document.getElementById('copyPublicBtn');
        const exportBtn = document.getElementById('exportBtn');
        const privateKeyEl = document.getElementById('privateKey');
        const publicKeyEl = document.getElementById('publicKey');
        const keySizeSelect = document.getElementById('keySize');
        const notificationEl = document.getElementById('notification');
        
        // 生成RSA密钥对
        generateBtn.addEventListener('click', async () => {
            // 显示加载状态
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i><span>生成中...</span>';
            
            try {
                const keySize = parseInt(keySizeSelect.value);
                
                // 使用forge库生成RSA密钥对
                const keys = await new Promise((resolve, reject) => {
                    const rsa = forge.pki.rsa;
                    rsa.generateKeyPair({
                        bits: keySize,
                        workers: -1, // 使用所有可用CPU核心
                        e: 0x10001
                    }, (err, keypair) => {
                        if (err) reject(err);
                        else resolve(keypair);
                    });
                });
                
                // 转换为PEM格式
                const privateKeyPem = forge.pki.privateKeyToPem(keys.privateKey);
                const publicKeyPem = forge.pki.publicKeyToPem(keys.publicKey);
                
                // 显示密钥
                privateKeyEl.value = privateKeyPem;
                publicKeyEl.value = publicKeyPem;
                
                // 启用导出按钮
                exportBtn.disabled = false;
                
                showNotification('密钥对生成成功', 'success');
            } catch (error) {
                console.error('生成密钥失败:', error);
                showNotification('生成密钥失败，请重试', 'error');
            } finally {
                // 恢复按钮状态
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fa fa-refresh"></i><span>生成密钥对</span>';
            }
        });
        
        // 复制私钥
        copyPrivateBtn.addEventListener('click', () => copyToClipboard(privateKeyEl.value, '私钥'));
        
        // 复制公钥
        copyPublicBtn.addEventListener('click', () => copyToClipboard(publicKeyEl.value, '公钥'));
        
        // 复制到剪贴板
        function copyToClipboard(text, type) {
            if (!text) {
                showNotification('没有可复制的内容，请先生成密钥', 'error');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification(`${type}已复制到剪贴板`, 'success');
            }).catch(err => {
                console.error('复制失败:', err);
                showNotification('复制失败，请手动复制', 'error');
            });
        }
        
        // 导出ZIP包
        exportBtn.addEventListener('click', async () => {
            const privateKey = privateKeyEl.value;
            const publicKey = publicKeyEl.value;
            
            if (!privateKey || !publicKey) {
                showNotification('请先生成密钥对', 'error');
                return;
            }
            
            try {
                // 创建ZIP文件
                const zip = new JSZip();
                
                // 添加文件
                zip.file("private_key.pem", privateKey);
                zip.file("public_key.pem", publicKey);
                
                // 生成ZIP并下载
                const content = await zip.generateAsync({ type: "blob" });
                saveAs(content, "rsa_keys.zip");
                
                showNotification('密钥包导出成功', 'success');
            } catch (error) {
                console.error('导出失败:', error);
                showNotification('导出失败，请重试', 'error');
            }
        });
        
        // 显示通知
        function showNotification(message, type) {
            // 设置通知样式和内容
            notificationEl.textContent = message;
            notificationEl.className = `fixed bottom-6 right-6 p-4 rounded-lg shadow-lg transform translate-y-0 opacity-100 transition-all duration-300 flex items-center gap-3 max-w-xs ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' : 
                'bg-red-100 text-red-800 border border-red-200'
            }`;
            notificationEl.innerHTML = `${
                type === 'success' ? '<i class="fa fa-check-circle text-green-500"></i>' : 
                '<i class="fa fa-exclamation-circle text-red-500"></i>'
            }<span>${message}</span>`;
            
            // 3秒后隐藏
            setTimeout(() => {
                notificationEl.classList.remove('translate-y-0', 'opacity-100');
                notificationEl.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>